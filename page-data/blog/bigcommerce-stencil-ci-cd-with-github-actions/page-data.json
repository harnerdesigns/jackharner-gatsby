{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/bigcommerce-stencil-ci-cd-with-github-actions/","result":{"data":{"site":{"siteMetadata":{"title":"Jack Harner","description":"Jack Harner is a Freelance Web Developer & E-Commerce Consultant based in Denver, Colorado. Shopify, BigCommerce, WordPress Dev & More.","author":"@jackharner","siteUrl":"https://jackharner.com"}},"markdownRemark":{"html":"<p>Post Updated November 21st, 2022 to work with Stencil-CLI >5.x</p>\n<p>Back in November 2019, GitHub released GitHub Actions. An <a href=\"https://github.blog/2019-08-08-github-actions-now-supports-ci-cd/\">\"API for cause and effect\"</a> they called it.</p>\n<p>Basically, GitHub Actions allow you to program things to happen when other things happen to your repo. For example, running tests on Pull Requests as they come in, or <a href=\"https://dev.to/gautamkrishnar/show-your-latest-dev-to-posts-automatically-in-your-github-profile-readme-3nk8\">updating your GitHub Profile Readme with your latest DEV posts</a>.</p>\n<p>Today I'm going to walk you through using GitHub Actions to publish your BigCommerce Stencil Theme automatically.</p>\n<h2>What is CI/CD?</h2>\n<p>CI/CD stands for Continuous Integration / Continuous Delivery. CI/CD is a coding philosophy that allows teams to publish changes often, without the daunting task of pushing to production manually.  Setting up a solid CI/CD Pipeline will save you and your team plenty of hours over the course of the project to make up for the initial time setting it up.</p>\n<h2>Bye Bye Bitbucket Pipelines.</h2>\n<p>The first iteration I tried for CI/CD on my Stencil Theme came from <a href=\"https://medium.com/bigcommerce-developer-blog/how-to-level-up-your-development-workflow-with-continuous-delivery-3a6493cc1d13\">this article</a> from BigCommerce. It talks about how to utilize BitBucket Pipelines to Auto-deploy your theme. I was storing our theme on BitBucket anyway because this was before GitHub offered free private repos, so it ended up working perfectly.</p>\n<p>Once GitHub allowed Free Private Repos for individuals (and eventually teams), I decided to move all of our repos back. I still wanted the CI/CD benefits of BitBucket Pipelines so I dove into GitHub Actions to see if I could make it work.</p>\n<h2>Folder Structure</h2>\n<p>The first thing you need to do to setup GitHub Actions is create a hidden folder called <code class=\"language-text\">.github</code> (note the period at the beginning) in the root of your theme. Inside that folder create one more folder called <code class=\"language-text\">workflows</code>. Now create a file in <code class=\"language-text\">/.github/workflows/</code> called <code class=\"language-text\">main.yml</code>.</p>\n<p>This YAML (a recursive acronym that stands for YAML Ain't Markup Language) file is what tells GitHub what to do, when to do it, &#x26; what to do it with.</p>\n<p>{{{vert}}}</p>\n<h2>Configuration</h2>\n<p>I've included the full code down below, but I'm going to walk through each piece so you understand what's happening and how to adjust it for your specific use case.</p>\n<h3>Name It</h3>\n<p>First things first, we've got to name this bad boi. Start your <code class=\"language-text\">main.yml</code> file off with the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Push Stencil Theme To BigCommerce.</code></pre></div>\n<p>This defines the name of the Workflow that you are creating and shows up on GitHub each time the workflow runs.</p>\n<h3>Main Branch Only</h3>\n<p>In order to save build minutes, we only want to run the workflow when something is pushed to the <code class=\"language-text\">main</code> branch. For that, add the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> main</code></pre></div>\n<p>The <code class=\"language-text\">on</code> option allows you to specify when to run the workflow. There are about 25 different events that you can configure workflows for, <a href=\"https://docs.github.com/en/actions/reference/events-that-trigger-workflows\">check out the full list here</a>.</p>\n<h3>Get A JOB You BUM!</h3>\n<p>The next thing we need to do is create the Job. This is where all the magic happens inside the Workflow.</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Stencil Push\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span> </code></pre></div>\n<p>Let's break that block down even further.</p>\n<ol>\n<li><code class=\"language-text\">jobs:</code> - This line defines an array so you can run multiple different jobs at a time.</li>\n<li><code class=\"language-text\">build:</code> - This is the ID for the job we are setting up. You can use the ID to reference jobs from other jobs, for example, to check if the first job exited a specific way.</li>\n<li><code class=\"language-text\">name: Stencil Push</code> - Pretty self-explanatory. Defines the name of the job.</li>\n<li><code class=\"language-text\">runs-on: ubuntu-latest</code> - This allows you to configure the OS of the computer that will be processing your Job. You can choose between Linux, Windows, And Mac Operating Systems, depending on your needs.</li>\n<li><code class=\"language-text\">steps:</code>  This starts the Steps array where you configure everything that happens inside the job.</li>\n</ol>\n<h3>STEP It Up</h3>\n<p>Jobs have multiple steps, just like workflows can have multiple jobs. The big difference is that steps run sequentially, waiting for one to finish before the next step starts.</p>\n<h4>Check It Out.</h4>\n<p>First things first we have to checkout the repository. If you're unfamiliar with Docker, basically you're spinning up a new blank virtual machine every time your job runs. In order to manipulate the files you need to get them first. Luckily, GitHub Actions comes with a pre-configured set of tools to do simple things like that:</p>\n<p>Start off your <code class=\"language-text\">steps</code> array with <strong>Step 1</strong>:</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Checkout Repository\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v1</code></pre></div>\n<p>The <code class=\"language-text\">uses</code> attribute in this step allows you to run other GitHub Actions inside your Action. This allows things to be modular and reusable. Check out <a href=\"https://github.com/actions\">GitHub.com/actions</a> for more info.</p>\n<h4>Node v14 Only</h4>\n<p>Since BigCommerce Stencil requires Node 14, <strong>Step 2</strong> involves installing the specific version of node we need:</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n  \n  <span class=\"token punctuation\">...</span>\n\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Set Node version to 14\n    <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/setup<span class=\"token punctuation\">-</span>node@v1\n    <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">node-version</span><span class=\"token punctuation\">:</span> <span class=\"token number\">14</span></code></pre></div>\n<p>On this step we now have the <code class=\"language-text\">with</code> attribute. This allows you to pass configuration options to your \"Uses\" actions. In this case we define <code class=\"language-text\">node-version</code> as <code class=\"language-text\">14</code> since that's what we need for the Stencil CLI to work.</p>\n<h4>Install Dependencies</h4>\n<p><strong>Step 3</strong> is kind of a 2 for 1 deal. With the <code class=\"language-text\">run</code> attribute on the step you can run console commands. The pipe <code class=\"language-text\">|</code> is used to start off a multi line command. Install the Stencil Cli first, and then run whichever package manager you use. In my case it's Yarn.</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n  \n  <span class=\"token punctuation\">...</span>\n  \n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Install Dependencies\n    <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n      npm install -g @bigcommerce/stencil-cli\n      yarn</span></code></pre></div>\n<p>{{{vert}}}</p>\n<h4>Configure Stencil CLI</h4>\n<blockquote>\n<p>Update as of 2022: <code class=\"language-text\">stencil init</code> now has all of the flags available to run through CI. The original setup involved storing the entire contents of the .stencil file as a secret in the repo.</p>\n</blockquote>\n<p>We need to add a couple secrets to the repo to keep our Stencil CLI Access Token secure. Open up your Repo and click Settings > Secrets > Actions > New secret. Name the first one <code class=\"language-text\">STENCIL_STORE_URL</code> and paste in your store's mybigcommerce.com url (i.e. <code class=\"language-text\">https://store-xxxxxxxxxx.mybigcommerce.com</code> ). Save that secret and add a second one called <code class=\"language-text\">STENCIL_ACCESS_TOKEN</code> with your Stencil CLI Access Token as the value. GitHub Secrets allow you to use sensitive data in your Actions without exposing it to the world.</p>\n<p>Once again we'll use Step Environment Variables to send our secrets to the <code class=\"language-text\">stencil init</code> command to generate the <code class=\"language-text\">secrets.stencil.json</code> and <code class=\"language-text\">config.stencil.json</code> files used connect the CI runner to our specific BigCommerce store:</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n\n  <span class=\"token punctuation\">...</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Connect to store\n      <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">URL</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.STENCIL_STORE_URL <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token key atrule\">TOKEN</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.STENCIL_ACCESS_TOKEN <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n      <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> stencil init <span class=\"token punctuation\">-</span>u $URL <span class=\"token punctuation\">-</span>t $TOKEN <span class=\"token punctuation\">-</span>p 3000 <span class=\"token punctuation\">-</span>h https<span class=\"token punctuation\">:</span>//api.bigcommerce.com</code></pre></div>\n<h4>Push It Gurl</h4>\n<p>The last thing to do is push the theme with the Stencil CLI. We use the aforementioned <code class=\"language-text\">-a</code> &#x26; <code class=\"language-text\">-d</code> flags to <strong>A</strong>ctivate a specific variation (in our case the variant called \"Light\") of the theme and to <strong>D</strong>elete the oldest unused theme (there is a limit to how many themes you can have uploaded to BigCommerce at one time).</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n\n  <span class=\"token punctuation\">...</span>\n\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Push Theme\n    <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n      stencil push -a Light -d</span></code></pre></div>\n<h2>That's All Folks</h2>\n<p>After that all you have to do is commit the workflow file to your repo and push it up to Github. As soon as it's in there, github will take that commit and run your Workflow against it.</p>\n<p>Be Careful Though, because at this point anything you push to your <code class=\"language-text\">main</code> branch will get automatically pushed to your live site. Make sure to follow good Git practices and only commit to the <code class=\"language-text\">main</code> branch PRODUCTION READY CODE. That is the beauty of using Git in your CI/CD Workflow because if you break something it's super simple to roll back the <code class=\"language-text\">main</code> branch to the previous commit, make your fixes and try again.</p>\n<h2>The Full Code</h2>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Push Stencil Theme To BigCommerce\n<span class=\"token comment\"># This workflow is triggered on pushes to the Main Branch only.</span>\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> main\n\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Stencil Push\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Checkout Repository\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v1\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Set Node version to 14\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/setup<span class=\"token punctuation\">-</span>node@v1\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">node-version</span><span class=\"token punctuation\">:</span> <span class=\"token number\">14</span>\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Install Dependencies\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n          npm install -g @bigcommerce/stencil-cli\n          yarn</span>\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Connect to store\n            <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">URL</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.STENCIL_STORE_URL <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n              <span class=\"token key atrule\">TOKEN</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.STENCIL_ACCESS_TOKEN <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n            <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> stencil init <span class=\"token punctuation\">-</span>u $URL <span class=\"token punctuation\">-</span>t $TOKEN <span class=\"token punctuation\">-</span>p 3000 <span class=\"token punctuation\">-</span>h https<span class=\"token punctuation\">:</span>//api.bigcommerce.com\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Push Theme\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n          stencil push -a Light -d</span></code></pre></div>\n<h2>Taking The BigCommerce CI/CD Flow A Step Further</h2>\n<p>Once you get settled into a CI/CD flow that works for you and your clients, here are a handful of ideas to extend it:</p>\n<ol>\n<li>Connect the workflow to send work to both a staging and production site.</li>\n<li>Setup an NPM / Yarn Cache to save time installing all the different dependencies.</li>\n<li>Modify the theme name with things like the date and the Pull Request info to connect the theme names back to the repo.</li>\n<li>Create a separate <a href=\"/blog/github-actions-cron/\">GitHub action that uses CRON</a> to regularly pull in the live theme on the store, capturing any changes your client made directly through the theme editor.</li>\n</ol>\n<p>And pretty much anything else you can think of that you can accomplish with GitHub Actions. Automating the deploy process makes it so much easier to focus on fixing bugs and building new features, instead of wasting time manually deploying new changes.</p>\n<blockquote>\n<p><span>Featured Image by <a href=\"https://unsplash.com/@martinadams?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText\">Martin Adams</a> on <a href=\"https://unsplash.com/s/photos/piping?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText\">Unsplash</a></span></p>\n</blockquote>","excerpt":"Post Updated November 21st, 2022 to work with Stencil-CLI >5.x Back in November 2019, GitHub released GitHub Actions. An \"API for cause and effectâ€¦","wordCount":{"words":1293},"frontmatter":{"date":"August 01, 2020","updated":"November 21, 2022","title":"BigCommerce Stencil CI/CD with GitHub Actions","subtitle":"Publish Your Theme on Every Commit to Main","tags":["BigCommerce","E-Commerce","Git","Automation","Newsletter"],"featuredImage":{"absolutePath":"/home/runner/work/jackharner-gatsby/jackharner-gatsby/content/blog/bigcommerce-stencil-ci-cd-with-github-actions/martin-adams-a_PDPUPuNZ8-unsplash.jpg","childImageSharp":{"original":{"src":"/static/martin-adams-a_PDPUPuNZ8-unsplash-e26ae245f60e09086890e12c5f409ce1.jpg"}}},"ogImage":null},"fields":{"externalLink":"","externalLinkLabel":"Check It Out Â»","slug":"/blog/bigcommerce-stencil-ci-cd-with-github-actions/","ogImage":"","date":"November 21, 2022","unlisted":false}}},"pageContext":{"slug":"/blog/bigcommerce-stencil-ci-cd-with-github-actions/","newsletter":true,"related":[{"id":"70ea0cac-1ea2-5429-b89d-cd87c58a7f88","excerpt":"I'm currently writing to you from a beautiful AirBnB in Bruges, Belgium, halfway through a birthday trip around Europe with my partnerâ€¦","fields":{"date":"2023-04-15T20:49:23.442Z","slug":"/blog/freelancing-and-traveling/","collection":"blog","published":true,"externalLink":"","externalLinkLabel":"Check It Out Â»"},"frontmatter":{"title":"Freelancing & Traveling","subtitle":"4 Things I Wish I Knew Before Freelancing Around Europe","tags":["Freelance","Travel"],"published":true,"featuredImage":{"childImageSharp":{"resize":{"src":"/static/298bfa9c74a357c44d4e8a682eb257b4/5ff92/amsterdam.jpg"}}}}},{"id":"76928994-68ea-561f-92d1-7bb1d90dcaf1","excerpt":"Customizing the WordPress Login Page The default WordPress Login page is so boring. A simple yet effective change you can do when building aâ€¦","fields":{"date":"2022-10-25T22:28:27.823Z","slug":"/blog/changing-the-wordpress-login-page-logo/","collection":"blog","published":true,"externalLink":"","externalLinkLabel":"Check It Out Â»"},"frontmatter":{"title":"Changing the WordPress Login Page Logo","subtitle":"","tags":["WordPress","Code Snippets"],"published":true,"featuredImage":{"childImageSharp":{"resize":{"src":"/static/12b3adb5fd7dd899512ab8f130a9016d/5ff92/murat-onder-EWDCeCUz8Ho-unsplash.jpg"}}}}},{"id":"0454def4-e65f-54ce-b7ab-810a32a06438","excerpt":"As of writing, I've been freelancing fulltime for just over 200 days now (Woo ðŸŽ‰) and I wanted to share with y'all what I've been doing toâ€¦","fields":{"date":"2021-12-12T20:04:46.451Z","slug":"/blog/how-to-get-freelance-clients-2021/","collection":"blog","published":true,"externalLink":"","externalLinkLabel":"Check It Out Â»"},"frontmatter":{"title":"How To Get Freelance Clients In 2021","subtitle":"What's Worked For Me & My Plans For 2022","tags":["Freelance","Career","Newsletter","Automation"],"published":true,"featuredImage":{"childImageSharp":{"resize":{"src":"/static/fcd777851be1d5f2e068c3b3c03320fa/5ff92/photo-1545987796-200677ee1011.jpg"}}}}}]}},"staticQueryHashes":["3649515864","764694655"]}