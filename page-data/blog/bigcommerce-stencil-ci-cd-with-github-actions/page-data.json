{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/bigcommerce-stencil-ci-cd-with-github-actions/","result":{"data":{"markdownRemark":{"html":"<p>Back in November 2019, GitHub released GitHub Actions. An <a href=\"https://github.blog/2019-08-08-github-actions-now-supports-ci-cd/\">\"API for cause and effect\"</a> they called it. </p>\n<p>Basically, GitHub Actions allow you to program things to happen when other things happen to your repo. For example, running tests on Pull Requests as they come in, or <a href=\"https://dev.to/gautamkrishnar/show-your-latest-dev-to-posts-automatically-in-your-github-profile-readme-3nk8\">updating your GitHub Profile Readme with your latest DEV posts</a>. </p>\n<p>Today I'm going to walk you through using GitHub Actions to publish your BigCommerce Stencil Theme automatically.</p>\n<h2>What is CI/CD?</h2>\n<p>CI/CD stands for Continuous Integration / Continuous Delivery. CI/CD is a coding philosophy that allows teams to publish changes often, without the daunting task of pushing to production manually.  Setting up a solid CI/CD Pipeline will save you and your team plenty of hours over the course of the project to make up for the initial time setting it up. </p>\n<h2>Bye Bye Bitbucket Pipelines.</h2>\n<p>The first iteration I tried for CI/CD on my Stencil Theme came from <a href=\"https://medium.com/bigcommerce-developer-blog/how-to-level-up-your-development-workflow-with-continuous-delivery-3a6493cc1d13\">this article</a> from BigCommerce. It talks about how to utilize BitBucket Pipelines to Auto-deploy your theme. I was storing our theme on BitBucket anyway because this was before GitHub offered free private repos, so it ended up working perfectly.</p>\n<p>Once GitHub allowed Free Private Repos for individuals (and eventually teams), I decided to move all of our repos back. I still wanted the CI/CD benefits of BitBucket Pipelines so I dove into GitHub Actions to see if I could make it work.  </p>\n<h2>Folder Structure</h2>\n<p>The first thing you need to do to setup GitHub Actions is create a folder called <code class=\"language-text\">.github</code> (note the period at the beginning) in the root of your theme. Inside that folder create one more folder called <code class=\"language-text\">workflows</code>. Now create a file in <code class=\"language-text\">/.github/workflows/</code> called <code class=\"language-text\">main.yml</code>.</p>\n<p>This YAML (a recursive acronym that stands for YAML Ain't Markup Language) file is what tells GitHub what to do, when to do it, &#x26; what to do it with.</p>\n<h2>Configuration</h2>\n<p>I've included the full code down below, but I'm going to walk through each piece so you understand what's happening and how to adjust it for your specific use case.</p>\n<h3>Name It</h3>\n<p>First things first, we've got to name this bad boi. Start your <code class=\"language-text\">main.yml</code> file off with the following: </p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Push Stencil Theme To BigCommerce.</code></pre></div>\n<p>This defines the name of the Workflow that you are creating and shows up on GitHub each time the workflow runs.</p>\n<h3>Main Branch Only</h3>\n<p>In order to save build minutes, we only want to run the workflow when something is Pushed to the Main branch. For that, add the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> main</code></pre></div>\n<p>The <code class=\"language-text\">on</code> option allows you to specify when to run the workflow. There are about 25 different events that you can configure workflows for, <a href=\"https://docs.github.com/en/actions/reference/events-that-trigger-workflows\">check out the full list here</a>. </p>\n<h3>Get A JOB You BUM!</h3>\n<p>The next thing we need to do is create the Job. This is where all the magic happens inside the Workflow.</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Stencil Push\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span> </code></pre></div>\n<p>Let's break that block down even further. </p>\n<ol>\n<li><code class=\"language-text\">jobs:</code> - This line defines an array so you can run multiple different jobs at a time.</li>\n<li><code class=\"language-text\">build:</code> - This is the ID for the job we are setting up. You can use the ID to reference jobs from other jobs, for example, to check if the first job exited a specific way. </li>\n<li><code class=\"language-text\">name: Stencil Push</code> - Pretty self-explanatory. Defines the name of the job. </li>\n<li><code class=\"language-text\">runs-on: ubuntu-latest</code> - This allows you to configure the OS of the computer that will be processing your Job. You can choose between Linux, Windows, And Mac Operating Systems, depending on your needs. </li>\n<li><code class=\"language-text\">steps:</code>  This starts the Steps array where you configure everything that happens inside the job. </li>\n</ol>\n<h3>STEP It Up</h3>\n<p>Jobs have multiple steps, just like workflows can have multiple jobs. The big difference is that steps run sequentially, waiting for one to finish before the next step starts.</p>\n<h4>Check It Out.</h4>\n<p>First things first we have to checkout the repository. If you're unfamiliar with Docker, basically you're spinning up a new blank virtual machine every time your job runs. In order to manipulate the files you need to get them first. Luckily, GitHub Actions comes with a pre-configured set of tools to do simple things like that:</p>\n<p>Start off your <code class=\"language-text\">steps</code> array with <strong>Step 1</strong>: </p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Checkout Repository\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v1</code></pre></div>\n<p>The <code class=\"language-text\">uses</code> attribute in this step allows you to run other GitHub Actions inside your Action. This allows things to be modular and reusable. Check out <a href=\"https://github.com/actions\">GitHub.com/actions</a> for more info.</p>\n<h4>Node v10 Only</h4>\n<p>Since BigCommerce stencil still requires Node 10, <strong>Step 2</strong> involves installing the specific version of node we need:</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n  \n  <span class=\"token punctuation\">...</span>\n\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Set Node version to 10\n    <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/setup<span class=\"token punctuation\">-</span>node@v1\n    <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">node-version</span><span class=\"token punctuation\">:</span> <span class=\"token number\">10</span></code></pre></div>\n<p>On this step we now have the <code class=\"language-text\">with</code> attribute. This allows you to pass configuration options to your \"Used\" actions. In this case we define <code class=\"language-text\">node-version</code> as <code class=\"language-text\">10</code> since that's what we need for the Stencil CLI to work. </p>\n<h4>Install Dependencies</h4>\n<p><strong>Step 3</strong> is kind of a 2 for 1 deal. With the <code class=\"language-text\">run</code> attribute on the step you can run console commands. The pipe <code class=\"language-text\">|</code> is used to start off a multi line command. Install the Stencil Cli first, and then run whichever package manager you use. In my case it's Yarn. </p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n  \n  <span class=\"token punctuation\">...</span>\n  \n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Install Dependencies\n    <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n      npm install -g @bigcommerce/stencil-cli\n      yarn</span></code></pre></div>\n<h4>Configure Stencil CLI</h4>\n<p>As far as <strong>Step 4</strong> goes, I tried a few different approaches and I'm not sure if this is the best way, but it works for me. What you need to do is pass in your BigCommerce API Token and basically everything in your Stencil CLI-generated <code class=\"language-text\">.stencil</code> file.</p>\n<p>I tried running <code class=\"language-text\">stencil init</code> which generates the file, but it's not set up to be run without  user input. It gets hung up on asking which goes against the core of CI/CD. Things need to be automatic. Maybe they'll add that like they did with <code class=\"language-text\">stencil push</code> with the <code class=\"language-text\">-a</code> and <code class=\"language-text\">-d</code> flags.</p>\n<p>The bitbucket pipeline recommends just checking in your <code class=\"language-text\">.stencil</code> to your repo and leaving it private. In order to not check in your keys to GitHub you should take advantage of GitHub Secrets. </p>\n<p>Open up your Repo and click Settings > Secrets > New secret. Name it <code class=\"language-text\">STENCIL</code> and paste in your entire <code class=\"language-text\">.stencil</code> file as the value. GitHub Secrets allow you to use sensitive data in your Actions without exposing it to the world at all. </p>\n<p>Now you can just copy the STENCIL secret to an env variable for the shell command <code class=\"language-text\">echo &quot;$STENCIL&quot; &gt; .stencil</code>. </p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n\n  <span class=\"token punctuation\">...</span>\n\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'echo \"$STENCIL\" > .stencil'</span>\n    <span class=\"token key atrule\">shell</span><span class=\"token punctuation\">:</span> bash\n    <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">STENCIL</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>secrets.STENCIL<span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></code></pre></div>\n<h4>Push It Gurl</h4>\n<p>The last thing to do is push the theme with the Stencil CLI. We use the aforementioned <code class=\"language-text\">-a</code> &#x26; <code class=\"language-text\">-d</code> flags to <strong>A</strong>ctivate a specific variation of the theme and to <strong>D</strong>elete the oldest unused theme (there is a limit to how many themes you can have uploaded to BigCommerce at one time).</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n\n  <span class=\"token punctuation\">...</span>\n\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Push Theme\n    <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n      stencil push -a Light -d</span></code></pre></div>\n<h2>That's All Folks</h2>\n<p>After that all you have to do is commit the workflow file to your repo and push it up to Github. As soon as it's in there, github will take that commit and run your Workflow against it. </p>\n<p>Be Careful Though, because at this point anything you push to your <code class=\"language-text\">main</code> branch will get automatically pushed to your live site. Make sure to follow good Git practices and only commit to the <code class=\"language-text\">main</code> branch PRODUCTION READY CODE. That is the beauty of using Git in your CI/CD Workflow because if you break something it's super simple to roll back the <code class=\"language-text\">main</code> branch to the previous commit, make your fixes and try again. </p>\n<h2>The Full Code</h2>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Push Stencil Theme To BigCommerce\n<span class=\"token comment\"># This workflow is triggered on pushes to the Main Branch only.</span>\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> main\n\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Stencil Push\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Checkout Repository\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v1\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Set Node version to 10\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/setup<span class=\"token punctuation\">-</span>node@v1\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">node-version</span><span class=\"token punctuation\">:</span> <span class=\"token number\">10</span>\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Install Dependencies\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n          npm install -g @bigcommerce/stencil-cli\n          yarn</span>\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'echo \"$STENCIL\" > .stencil'</span>\n        <span class=\"token key atrule\">shell</span><span class=\"token punctuation\">:</span> bash\n        <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">STENCIL</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>secrets.STENCIL<span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Push Theme\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n          stencil push -a Light -d</span></code></pre></div>\n<blockquote>\n<p><span>Featured Image by <a href=\"https://unsplash.com/@martinadams?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText\">Martin Adams</a> on <a href=\"https://unsplash.com/s/photos/piping?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText\">Unsplash</a></span></p>\n</blockquote>","excerpt":"Back in November 2019, GitHub released GitHub Actions. An \"API for cause and effect\" they called it.  Basically, GitHub Actions allow you to program…","wordCount":{"words":1168},"frontmatter":{"date":"August 01, 2020","title":"BigCommerce Stencil CI/CD with GitHub Actions","subtitle":"Publish Your Theme on Every Commit to Main","tags":["BigCommerce","Git","Automation","Newsletter"],"featuredImage":{"absolutePath":"/home/runner/work/jackharner-gatsby/jackharner-gatsby/src/content/blog/bigcommerce-stencil-ci-cd-with-github-actions/martin-adams-a_PDPUPuNZ8-unsplash.jpg","childImageSharp":{"sizes":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAQFAv/EABQBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAActPzxfIon//xAAaEAACAgMAAAAAAAAAAAAAAAABAgADEBEU/9oACAEBAAEFAld1gvxoGXgKeiyf/8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQMBAT8BR//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABkQAQACAwAAAAAAAAAAAAAAAAABIRAiMf/aAAgBAQAGPwJtGLVDr//EAB4QAAIBAwUAAAAAAAAAAAAAAAABIRExUUFxobHB/9oACAEBAAE/IWjxhPxi44Sg7QnuhMoqF2KlEdLH/9oADAMBAAIAAwAAABCYH//EABgRAQEAAwAAAAAAAAAAAAAAAAEAESFR/9oACAEDAQE/EBy7kdv/xAAWEQEBAQAAAAAAAAAAAAAAAAAAETH/2gAIAQIBAT8QxX//xAAeEAEAAgICAwEAAAAAAAAAAAABABEhUTFBYZHR8P/aAAgBAQABPxDKyg7FfjcGBhdM+n7AoJkSyA0L4GH18mOOUJRjqRIatJ//2Q==","aspectRatio":1.5037593984962405,"src":"/static/e26ae245f60e09086890e12c5f409ce1/14b42/martin-adams-a_PDPUPuNZ8-unsplash.jpg","srcSet":"/static/e26ae245f60e09086890e12c5f409ce1/f836f/martin-adams-a_PDPUPuNZ8-unsplash.jpg 200w,\n/static/e26ae245f60e09086890e12c5f409ce1/2244e/martin-adams-a_PDPUPuNZ8-unsplash.jpg 400w,\n/static/e26ae245f60e09086890e12c5f409ce1/14b42/martin-adams-a_PDPUPuNZ8-unsplash.jpg 800w,\n/static/e26ae245f60e09086890e12c5f409ce1/47498/martin-adams-a_PDPUPuNZ8-unsplash.jpg 1200w,\n/static/e26ae245f60e09086890e12c5f409ce1/0e329/martin-adams-a_PDPUPuNZ8-unsplash.jpg 1600w,\n/static/e26ae245f60e09086890e12c5f409ce1/878e2/martin-adams-a_PDPUPuNZ8-unsplash.jpg 3741w","sizes":"(max-width: 800px) 100vw, 800px","originalImg":"/static/e26ae245f60e09086890e12c5f409ce1/878e2/martin-adams-a_PDPUPuNZ8-unsplash.jpg"}}},"ogImage":null},"fields":{"externalLink":"","slug":"/blog/bigcommerce-stencil-ci-cd-with-github-actions/","ogImage":"","date":"August 09, 2020","unlisted":false}}},"pageContext":{"slug":"/blog/bigcommerce-stencil-ci-cd-with-github-actions/","newsletter":true,"related":[{"id":"92a99743-ead1-5fdb-b6f0-e62bf27128c5","excerpt":"I read this great article from @swizec about how he made almost $400k over 5 years on the side through books, courses and other digital…","fields":{"slug":"/blog/lets-make-a-newsletter/","collection":"blog","published":true,"externalLink":""},"frontmatter":{"title":"Let's Make A Newsletter","subtitle":"Mailing Lists Are King","tags":["Newsletter"],"published":true,"featuredImage":{"childImageSharp":{"resize":{"src":"/static/22e8797ae72e98b620c3c6fddb12e28e/5ff92/liam-truong-oeDH20DVb2A-unsplash.jpg"}}}}},{"id":"e371a21f-1ede-5a44-b1f8-f67d0c995219","excerpt":"So, you want to make some changes to an Open Source Repo? Good for you. That's the beauty of Open Source, even just fixing typos in the…","fields":{"slug":"/blog/sync-forked-repo/","collection":"blog","published":true,"externalLink":""},"frontmatter":{"title":"I've Forked The Repo, Now What?","subtitle":"Syncing Your Repo With the Upstream Repo","tags":["Git","Open Source"],"published":true,"featuredImage":{"childImageSharp":{"resize":{"src":"/static/58ffde237fbc2fe080c4616ae4f133e5/5ff92/featuredImage.jpg"}}}}},{"id":"41b87014-ca75-5f76-a2e6-3baba0bbcd73","excerpt":"Back in November 2019, GitHub released GitHub Actions. An \"API for cause and effect\" they called it.  Basically, GitHub Actions allow you to…","fields":{"slug":"/blog/bigcommerce-stencil-ci-cd-with-github-actions/","collection":"blog","published":true,"externalLink":""},"frontmatter":{"title":"BigCommerce Stencil CI/CD with GitHub Actions","subtitle":"Publish Your Theme on Every Commit to Main","tags":["BigCommerce","Git","Automation","Newsletter"],"published":true,"featuredImage":{"childImageSharp":{"resize":{"src":"/static/e26ae245f60e09086890e12c5f409ce1/5ff92/martin-adams-a_PDPUPuNZ8-unsplash.jpg"}}}}}]}},"staticQueryHashes":["3649515864","764694655"]}